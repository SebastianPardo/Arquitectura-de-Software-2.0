<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">

    <h:head>
        <title>UN Profile</title>
    </h:head>
    <b:modal id="amodal" title="Editar datos" styleClass="modalPseudoClass">
        <h:form id="editForm">
            <b:row>
                <b:column>
                    <b:label text="#{loginBean.user.usrMail}"/>
                </b:column>
            </b:row>
            <b:row>
                <b:column>
                    <b:inputSecret label="Contraseña" id="pass1" value="#{loginBean.user.usrPass}" validator="#{loginBean.validatePass}">
                        <f:attribute name="confirmPass" value="#{confirmPass}" />
                    </b:inputSecret>
                </b:column>
            </b:row>
            <b:row>
                <b:column>
                    <b:inputSecret label="Repetir contraseña" id="pass2" binding="#{confirmPass}" required="true" autocomplete="off" required-message="Debe introducir nuevamente la contraseña" immediate="true" />
                </b:column>
            </b:row>
            <b:row>
                <b:column>
                    <b:inputText label="Alias" value="#{loginBean.user.usrAlias}" id="alias"/>
                </b:column>
            </b:row>
            <b:row>
                <b:column>
                    <b:inputText label="Nombre" id="name" value="#{loginBean.user.usrName}" required="true" requiredMessage="El nombre es obligatorio"/>
                </b:column>
            </b:row>
            <b:row>
                <b:column>
                    <b:inputText label="Apellido" id="lastname" value="#{loginBean.user.usrLastName}" required="true" requiredMessage="El apellido es obligatorio"/>
                </b:column>
            </b:row>
            <b:row>
                <b:column>

                    <b:selectOneMenu label="Género" value="#{loginBean.user.usrGenre}" id="genre">
                        <f:selectItem itemLabel="Masculino" itemValue="M"/>
                        <f:selectItem itemLabel="Femenio" itemValue="F"/>
                    </b:selectOneMenu>
                </b:column>
            </b:row>
            <b:row>
                <b:column>
                    <b:inputText label="Teléfono" id="tel" value="#{loginBean.user.usrTel}" required="true" requiredMessage="El teléfono es obligatorio"/>
                </b:column>
            </b:row>
            <b:row>
                <b:column>
                    <b:dateTimePicker label="Fecha de nacimiento" value="#{loginBean.user.usrDate}" id="date" mode="inline" show-time="false" minDate="" required="true" required-message="Por favor escoja una fecha de nacimiento"/>
                </b:column>
            </b:row>


            <b:row>
                <b:column span="4" offset="4">
                    <b:commandButton value="Guardar" look="info btn-block" action="#{loginBean.save()}" style="width:100%" />
                </b:column>
            </b:row>

            <b:row>
                <b:column>
                    <b:messages id="messagesEditForm" for="editForm" styleClass="msgs" redisplay="true" recursive="true"/>
                </b:column>
            </b:row>

            <f:facet name="footer">
                <b:button value="Cancelar" dismiss="modal" onclick="#{loginBean.cancelEdit()};"/>
                <b:button value="Guardar" look="primary" dismiss="modal" onclick="#{loginBean.save()};"/>
            </f:facet>
        </h:form>
    </b:modal>

    <h:body style="padding: 40px;" onload="document.getElementById('requests').hidden = true;">
        <b:form id="barForm">
            <b:navBar brand="UNProfiles" brandHref="/UNProfile/faces/bootstrap.xhtml" fixed="top" inverse="true">
                <b:navbarLinks>

                    <b:navLink value="Cerrar" href="/UNProfile/faces/login_c.xhtml" action="#{loginBean.logout()}"></b:navLink>
                </b:navbarLinks>
            </b:navBar>
        </b:form>
        <b:container fluid="true">
            <b:well>
                <h1>#{loginBean.user.usrAlias}</h1>
                <p>#{loginBean.user.usrName} #{loginBean.user.usrLastName}
                    <b:button look="link" value="" icon="glyphicon-pencil" size="lg" tooltip="Editar mis datos" p:data-target="#amodal" p:data-toggle="modal" onclick="return false;"/>
                </p>

                <b:row >
                    <b:column span="1" offset="11">

                        <b:button look="link" value="" icon="globe" tooltip="Tienes #{loginBean.user.usrPendingFriendsReceived.size()} solicitudes pendientes" size="lg" disabled="false"
                                  onclick="if (#{loginBean.user.usrPendingFriendsReceived.size()} > 0)
                                              if (document.getElementById('requests').hidden) {
                                                  document.getElementById('requests').hidden = false;
                                              } else {
                                                  document.getElementById('requests').hidden = true;
                                              }"/> 

                        <b:container id="requests" style="
                                     position: absolute;
                                     background-color: #F9F9F9;
                                     max-height: 350px;
                                     box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
                                     padding: 12px;
                                     z-index: 1;
                                     left: -288px;
                                     right: -20px;
                                     width: 380px;
                                     overflow-y: auto;">
                            <b:form id="requestsForm">
                                <c:forEach items="#{loginBean.user.usrPendingFriendsReceived}" var="user" varStatus="count">

                                    <b:container id="RequestedFriends" fluid="true" style="padding-left: 35px; padding-right: 25px; margin-bottom: 5px; border: 1px solid #a1a1a1;">
                                        <h1>#{user.usrAlias}</h1>
                                        <p>#{user.usrName} #{usr.usrLastName}</p>
                                        <p>#{user.usrMail}</p>
                                        <b:row>
                                            <b:column span="1" offset="8">
                                                <b:commandButton look="link" value="" icon="glyphicon-plus" tooltip="Agregar" action="#{userBean.answerFriendRequest(loginBean.user.usrId, user.usrId, true)}" update="requestsForm amigos sugestedForm"/>
                                            </b:column>
                                            <b:column span="1">
                                                <b:commandButton look="link" value="" icon="glyphicon-remove" tooltip="Rechazar" style="color: rgb(255, 8, 8);" action="#{userBean.answerFriendRequest(loginBean.user.usrId, user.usrId, false)}" update="requestsForm amigos sugestedForm"/>
                                            </b:column>
                                        </b:row>
                                    </b:container>

                                </c:forEach>
                            </b:form>
                        </b:container>

                    </b:column>
                </b:row>
            </b:well>

            <b:container fluid="true">
                <b:form id="amigos">
                    <b:dataTable id ="userFriends" span="9" lang="es" value="#{loginBean.user.usrFriends}" var="user" searching="true">

                        <b:dataTableColumn data-search="#{user.usrAlias} #{user.usrName}  #{user.usrLastName} #{user.usrMail}" rendered="false"/>
                        <b:dataTableColumn label="Amgos" orderable="true">
                            <b:container fluid="true">
                                <b:button look="link" value="#{user.usrAlias}"/>
                                <p>#{user.usrName} #{user.usrLastName}</p>
                                <p>#{user.usrMail}</p>
                            </b:container>
                        </b:dataTableColumn>
                        <b:dataTableColumn label="" style="width: 100px;">
                            <b:container fluid="true">
                                <b:commandButton id="deleteFriend" look="link" value="" icon="glyphicon-remove" style="color: rgb(255, 174, 8);" tooltip="Eliminar" action="#{userBean.deleteFriend(loginBean.user.usrId, user.usrId)}" update="amigos"/>
                                <b:commandButton id="blockFriend" look="link" value="" icon="glyphicon-ban-circle" style="color: rgb(255, 8, 8);" tooltip="Bloquear" action="#{userBean.blockFriend(loginBean.user.usrId, user.usrId)}" update="amigos"/>
                            </b:container>
                        </b:dataTableColumn>
                    </b:dataTable>
                </b:form>

                <b:form id="sugestedForm">
                    <b:carousel id="sugested" span="3" showIndicators="true" style="position: relative;color: #FFF;background: #4A4A4A;background-clip: content-box" tooltip="Sugerencias">

                        <c:forEach items="#{userBean.appController.loadSugestedFriendsFrom(loginBean.user.usrId)}" var="usr">
                            <b:carouselItem style="width:400px;height:230px;">
                                <b:container id="SuggestedFriend" fluid="true" style="padding-left: 35px; padding-right: 25px;">
                                    <h1>#{usr.usrAlias}</h1>
                                    <p>#{usr.usrName} #{usr.usrLastName}</p>
                                    <p>#{usr.usrMail}</p>
                                    <b:row>
                                        <b:column span="4" offset="5">
                                            <b:commandButton look="link" value="" icon="glyphicon-plus" tooltip="Agregar" action="#{userBean.addFriend(loginBean.user.usrId, usr.usrId)}" update="sugestedForm"/>    
                                        </b:column>
                                    </b:row>
                                </b:container>
                            </b:carouselItem>
                        </c:forEach>


                    </b:carousel>
                </b:form>
            </b:container>
        </b:container>
    </h:body>
</html>
